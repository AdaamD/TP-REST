<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comparateur d'offres d'hébergement</title>
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>

<h1>Comparateur d'offres d'hébergement</h1>

<form id="compareForm">
  <label for="dateDebut">Date de début:</label>
  <input type="date" id="dateDebut" name="dateDebut" required><br>

  <label for="dateFin">Date de fin:</label>
  <input type="date" id="dateFin" name="dateFin" required><br>

  <label for="nombrePersonnes">Nombre de personnes:</label>
  <input type="number" id="nombrePersonnes" name="nombrePersonnes" required><br>

  <label for="nombreEtoiles">Nombre d'étoiles minimum:</label>
  <input type="number" id="nombreEtoiles" name="nombreEtoiles" required><br>

  <input type="submit" value="Comparer les offres">
</form>

<div id="compareResult"></div>

<script>
  document.getElementById('compareForm').addEventListener('submit', function (event) {
    event.preventDefault(); // Empêche le formulaire de se soumettre normalement

    // Récupérez les valeurs des champs
    var dateDebut = document.getElementById('dateDebut').value;
    var dateFin = document.getElementById('dateFin').value;
    var nombrePersonnes = document.getElementById('nombrePersonnes').value;
    var nombreEtoiles = document.getElementById('nombreEtoiles').value;

    // Effectuez la requête avec les paramètres
    compareOffers(dateDebut, dateFin, nombrePersonnes, nombreEtoiles);
  });

  function compareOffers(dateDebut, dateFin, nombrePersonnes, nombreEtoiles) {
    var xhr = new XMLHttpRequest();

    // Construisez l'URL avec les paramètres
    var url = 'http://localhost:8080/comparateur/compare?' +
            '&dateDebut=' + dateDebut +
            '&dateFin=' + dateFin +
            '&nombrePersonnes=' + nombrePersonnes +
            '&nombreEtoiles=' + nombreEtoiles;

    xhr.open('POST', url, true);

    xhr.onload = function () {
      if (xhr.status === 200) {
        var responseData = JSON.parse(xhr.responseText);
        displayComparisonResults(responseData);
      } else {
        if (xhr.status === 401) {
          alert("L'authentification a échoué. Veuillez vérifier vos informations." + xhr.statusText);
        } else if (xhr.status === 404) {
          alert("Aucune offre disponible pour les critères spécifiés." + xhr.statusText);
        } else {
          console.error('La requête a échoué. Statut de la réponse : ' + xhr.status);
        }
      }
    };

    xhr.onerror = function () {
      console.error('Erreur de réseau lors de la tentative de faire la requête.');
    };

    // Envoyez la requête
    xhr.send();
  }

  function displayComparisonResults(data) {
    var resultDiv = document.getElementById('compareResult');

    // Créez un tableau HTML pour afficher les offres
    resultDiv.innerHTML = '<h2>Résultats de la comparaison :</h2>';
    var table = document.createElement('table');
    table.innerHTML = `
        <tr>
          <th>ID Offre</th>
          <th>Date Disponibilité</th>
          <th>Date Expiration</th>
          <th>Prix</th>
          <th>Numéro Chambre</th>
          <th>Nombre de Lits</th>
          <th>Nom de l'Hôtel</th>
          <th>Nom de l'Agence </th>
          <th>Image</th>
        </tr>
    `;

    data.forEach(function (offer) {
      var row = table.insertRow();
      row.innerHTML = `
          <td>${offer.idOffre}</td>
          <td>${offer.dateDisponibilite}</td>
          <td>${offer.dateExpiration}</td>
          <td>${offer.prix} euros</td>
          <td>${offer.numeroChambre}</td>
          <td>${offer.nombreLits}</td>
          <td>${offer.nomHotel}</td>
        <td>${offer.nomAgence}</td>
          <td> <img src="/${offer.imageURL}" class="image-preview"> </td>

        `;
    });

    resultDiv.appendChild(table);
  }


</script>

</body>

</html>
