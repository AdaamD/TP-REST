<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Réservation de chambre</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>

<h1>Réservation de chambre</h1>

<form id="reservationForm">
    <label for="nomAgence">Nom de l'agence:</label>
    <input type="text" id="nomAgence" name="nomAgence" required><br>

    <label for="motDePasse">Mot de passe:</label>
    <input type="password" id="motDePasse" name="motDePasse" required><br>

    <label for="offreId">ID de l'offre:</label>
    <input type="number" id="offreId" name="offreId" required><br>

    <label for="nomClient">Nom du client:</label>
    <input type="text" id="nomClient" name="nomClient" required><br>

    <label for="prenomClient">Prénom du client:</label>
    <input type="text" id="prenomClient" name="prenomClient" required><br>

    <!-- Ajout des champs de date d'arrivée et de départ -->
    <label for="dateArrive">Date d'arrivée:</label>
    <input type="date" id="dateArrive" name="dateArrive" required><br>

    <label for="dateDepart">Date de départ:</label>
    <input type="date" id="dateDepart" name="dateDepart" required><br>

    <input type="submit" value="Réserver">
</form>

<div id="reservationResult"></div>

<script>
    // Récupérez les paramètres de l'URL
    var urlParams = new URLSearchParams(window.location.search);
    var offreIdParam = urlParams.get('offreId');

    // Si le paramètre offreId existe, pré-remplissez le champ correspondant
    if (offreIdParam) {
        document.getElementById('offreId').value = offreIdParam;
    }

    document.getElementById('reservationForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Empêche le formulaire de se soumettre normalement

        // Récupérez les valeurs des champs
        var agenceNom = document.getElementById('nomAgence').value;
        var motDePasse = document.getElementById('motDePasse').value;
        var offreId = document.getElementById('offreId').value;
        var nomClient = document.getElementById('nomClient').value;
        var prenomClient = document.getElementById('prenomClient').value;

        // Effectuez la requête avec les paramètres
        makeReservation(agenceNom, motDePasse, offreId, nomClient, prenomClient);
    });

    function makeReservation(agenceNom, motDePasse, offreId, nomClient, prenomClient) {
        // Récupérez les valeurs des champs de date
        var dateArrive = document.getElementById('dateArrive').value;
        var dateDepart = document.getElementById('dateDepart').value;

        var xhr = new XMLHttpRequest();

        // Construisez l'URL avec les paramètres, y compris les dates d'arrivée et de départ
        var url = 'http://localhost:8080/agences/effectuerReservation?' +
            'nomAgence=' + agenceNom +
            '&mdpAgence=' + motDePasse +
            '&offreId=' + offreId +
            '&dateArrive=' + dateArrive +
            '&dateDepart=' + dateDepart +
            '&nomClient=' + nomClient +
            '&prenomClient=' + prenomClient;

        xhr.open('POST', url, true);

        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                // Affichez une alerte pour confirmer la réservation
                alert('Réservation confirmée!');

                // Afficher un récapitulatif de la réservation
                displayReservationSummary(JSON.parse(xhr.responseText));
            } else {
                console.error('La requête a échoué. Statut de la réponse : ' + xhr.status);
            }
        };

        xhr.onerror = function() {
            console.error('Erreur de réseau lors de la tentative de faire la requête.');
        };

        // Envoyez la requête sans le corps (les données du client seront dans l'URL)
        xhr.send();
    }

    // Fonction pour afficher un récapitulatif de la réservation
    function displayReservationSummary(reservationDetails) {
        console.log('Détails de la réservation reçus :', reservationDetails);
        var resultDiv = document.getElementById('reservationResult');
        resultDiv.innerHTML = '<h2>Récapitulatif de la réservation :</h2><pre>' + reservationDetails + '</pre>';
        // Ajoutez d'autres informations de réservation si nécessaire
    }
</script>

</body>
</html>