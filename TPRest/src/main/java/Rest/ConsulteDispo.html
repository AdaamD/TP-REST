<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recherche de chambre</title>
</head>
<body>

<h1>Recherche de chambre</h1>

<form id="searchForm">
    <label for="identifiant">Identifiant de l'agence:</label>
    <input type="text" id="identifiant" name="identifiant" required><br>

    <label for="motDePasse">Mot de passe:</label>
    <input type="password" id="motDePasse" name="motDePasse" required><br>

    <label for="dateDebut">Date de début:</label>
    <input type="date" id="dateDebut" name="dateDebut" required><br>

    <label for="nombreLit">Nombre de lits:</label>
    <input type="number" id="nombreLit" name="nombreLit" required><br>

    <input type="submit" value="Rechercher">
</form>

<div id="result"></div>

<script>
    document.getElementById('searchForm').addEventListener('submit', function(event) {
        event.preventDefault(); // Empêche le formulaire de se soumettre normalement

        // Récupérez les valeurs des champs
        var identifiant = document.getElementById('identifiant').value;
        var motDePasse = document.getElementById('motDePasse').value;
        var dateDebut = document.getElementById('dateDebut').value;
        var nombreLit = document.getElementById('nombreLit').value;

        // Effectuez la requête avec les paramètres
        makeRequest(identifiant, motDePasse, dateDebut, nombreLit);
    });

    function makeRequest(identifiant, motDePasse, dateDebut, nombreLit) {
        var xhr = new XMLHttpRequest();

        // Construisez l'URL avec les paramètres
        var url = 'http://localhost:8080/agences/consulter-disponibilite?' +
            'identifiant=' + identifiant +
            '&motDePasse=' + motDePasse +
            '&dateDebut=' + dateDebut +
            '&nombreLit=' + nombreLit;

        xhr.open('GET', url, true);

        xhr.onload = function() {
            if (xhr.status >= 200 && xhr.status < 300) {
                var responseData = JSON.parse(xhr.responseText);
                displayData(responseData);
            } else {
                console.error('La requête a échoué. Statut de la réponse : ' + xhr.status);
            }
        };

        xhr.onerror = function() {
            console.error('Erreur de réseau lors de la tentative de faire la requête.');
        };

        xhr.send();
    }

    function displayData(data) {
        var resultDiv = document.getElementById('result');
        // Créez des éléments HTML pour chaque offre
        resultDiv.innerHTML = '<h2>Résultats :</h2>';
        var ul = document.createElement('ul');

        data.forEach(function(offre) {
            var li = document.createElement('li');
            li.innerHTML = `<strong>ID:</strong> ${offre.idOffre}, <strong>Prix:</strong> ${offre.prix}, <strong>Hôtel:</strong> ${offre.nomHotel}, <strong>Chambre:</strong> ${offre.numeroChambre}, <strong>Lits:</strong> ${offre.nombreLits}`;
            ul.appendChild(li);
        });

        resultDiv.appendChild(ul);
    }
</script>

</body>
</html>
